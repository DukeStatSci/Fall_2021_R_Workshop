---
title: "Fall 2021 Workshop"
author: "Meredith Brown"
output:
   html_document:
    theme: cerulean
    toc: true
    toc_depth: 3
    toc_float: 
      collapsed: true
---

```{r setup, include=FALSE}
library(tidyverse)
```

## Introduction

This workshop is for students new to R and RStudio.

Your introductory StatSci course this semester will march you through a thorough introduction to using R for statistical science and data science purposes, as well as for many other practical applications.
You should already be familiar with the environment you are going to use for your course, most likely a Docker container provided through your course.
Your instructor should have given you that information and you should be ready to use it.

The materials here are a compilation of advice and instructions from your professors, undergraduate and graduate TAs, and many helpful resources.

Here are some key ideas:

-   Everyone can learn R!
    It is very user-friendly, so do not be intimidated!

-   R is an open source programming language for statistical computing (<http://cran-r-project.org>).

-   RStudio is the IDE or Interactive Development Environment we use to work in R.
    RStudio is available open source, but their company also provides some cloud-based servers for working in their environment, known as RStudio in the Cloud.

## Getting Started

### Creating a GitHub Account

If you're new to GitHub, you'll first need to go in and create an account.
You will use GitHub to obtain the RMarkdown or .Rmd file for this workshop.
If you already have a GitHub account, great!
If not, take a minute to create one.
But first, some username advice:

-   Try to incorporate your name!

-   Remember that horrible Snapchat username you made in middle school?
    Don't do that again.
    Make your username something you will feel comfortable sharing with future employers!

-   Make it short and sweet!

After creating your account, **write down your username and password**.

## R Overview

### RStudio

Your RStudio window generally has four panels.
This is customizable so you might have changed it already.
You can also drag the borders to resize each portion.

-   **Source**: Where R markdown files are produced and saved

-   **Console**: Where live R code is run; cannot be saved

-   **Environment**: Where R objects live and are stored

-   **Utility**: Where directories, plots, packages, and help can be found

![](images/rstudio.jpeg){width="90%"}

Your R Markdown file (<this-document>.Rmd) is in the upper left panel.
If you want to view this .Rmd file in a nicer format, click the Knit button above.
This will turn your .Rmd file into a HTML or PDF file.
The .Rmd and .html files are separate but directly related; after you make any changes in the .Rmd file, click Knit to update the .html file.

The panel in the upper right contains any data you have loaded, as well as a history of the commands that you've previously entered.
You can also use the **Git** interface in this panel.

Any plots that you generate will show up in the panel in the lower right corner.
This is also where you can browse your files, access help, manage packages, etc.

Your console, in the bottom left panel, can be used to run code.
Do this with caution as your code will not be saved.

### R Markdown

The console is a great place for playing around with code, however it is not a good place for documenting your work.
Working in the console exclusively makes it difficult to document your work as you go, and reproduce it later.

R Markdown is a great solution for this problem.
And, you already have worked with an R Markdown document -- this workshop!
Type code in the code chunks provided in the R Markdown (Rmd) document, and **Knit** the document to see the results.
Knit should produce an HTML file for you that lets you view the output of your code.

### R Packages

R is an open-source programming language, meaning that users can contribute packages that make our lives easier, and we can use them for free.
For this workshop, and many others in the future, we will use the following R packages:

-   `tidyverse`: A group of packages for data manipulation, exploration and visualization that share a common coding syntax and style.
-   `dplyr`: A package in the tidyverse for data wrangling
-   `ggplot2`: A package in the tidyverse for data visualization
-   `usethis`: A package for interfacing between RStudio and Github

These packages and most packages you will use for your courses have been preinstalled in the docker containers for you.
In the future, if you download RStudio locally or wish to install new packages for your personal use, you can install packages using commands like `install.packages` and `install_github`.
Find out more about the tidyverse [here.](https://rviews.rstudio.com/2017/06/08/what-is-the-tidyverse/)

Next, you need to load the packages in your working environment.
We do this with the `library` function.
Note that you only need to **install** packages once, but you need to **load** them each time you relaunch RStudio.

```{r load-packages, eval = TRUE, echo = TRUE, message = FALSE, warning = FALSE}
library(tidyverse)
library(dplyr)
library(ggplot2)
library(usethis)
```

To do so, you can do any one of the following options:

-   Click on the green arrow at the top of the code chunk in the R Markdown (Rmd) file

-   Highlight these lines, and hit the **Run** button on the upper right corner of the pane, or

-   Hit `CTRL` + `ENTER` to run the current line of code

-   Hit `CTRL` + `SHIFT` + `ENTER` to run the current chunk of code

-   Type the code in the console.

    -   Note: Running code in the console is useful for testing code and seeing the current status of variables, but any code that you want in your final .Rmd file should be put in a code chunk in the .Rmd.

Going forward you will be asked to load any relevant packages at the beginning of each lab.

## Github and RStudio

### Authenticating with SSH

Git is used to integrate GitHub and Version Control into your RStudio IDE.

To connect to Github, do the following:

1.  In the console of the docker container, type `credentials::ssh_setup_github()`. R will ask "No SSH key found. Generate one now?" You should **click 1 for yes**.
2.  You will generate a key. It will begin with "ssh-rsa..." R will then ask "Would you like to open a browser now?" You should **click 1 for yes**.
3.  In Github in the browser, give your key a name and **paste the generated key**. Hit save and refresh Github.
4.  This process will only need to be done one time for your container.

![](images/SSH_key.png){width="50%"}

### Configure your GitHub Account

You will use the `use_git_config()` function from the `usethis` package.

Type the following lines of code in the console in RStudio filling in your name and email address.

The email address is the one tied to your GitHub account.

```{r get your github congfigured, echo=TRUE, eval=FALSE}
library(usethis)
use_git_config(user.name = "GitHub username", user.email="your email")
```

For example, Meredith's would be:

```{r github-usethis-ex, echo=TRUE, eval = FALSE}
library(usethis)
use_git_config(user.name="meredithb3", user.email="meredith.brown@duke.edu")
```

Take a minute to configure your GitHub account into RStudio!

### Fork and Clone Fall Workshop

Now on GitHub, search for the following repository: <https://github.com/DukeStatSci/Fall_2021_R_Workshop>

First, **Fork** the repository by clicking Fork in the upper right-hand portion of the screen.
Forking allows you to make changes to the repository with Version Control, without changing the repository for others.

![](images/new_fork.png){width="90%"}

Click on the green `Code` button and then click on the clipboard icon next to the URL to copy the repository link.
Make sure to copy the URL corresponding to the `SSH` tab.

![](images/new_clone-repo.png){width="90%"}

Now open your RStudio window.

Click `File` $\rightarrow$ `New Project` $\rightarrow$ `Version Control` $\rightarrow$ `Git` and hit `paste` in the `Repository URL` field.

-   You will need to select a location to store this project. Good coding practice suggests creating a folder for your class, and then sub-folders for labs, homeworks, etc.

Now click `Create Project`.

To view the output that I am currently sharing with you, click on the file `fallWorkshop.Rmd` and click **Knit** on the file.

## Diving into the Data

We are going to use a data set called `starwars` from the `dplyr` package.
Simply run `library(tidyverse)` or `library(dyplr)` if you haven't already, and then call `data(starwars)` to load in the data set.
To get you started, run the following command to load the data and to inspect the first ten rows of the file.

```{r load-starwars-data, echo=TRUE}
# Load the starwars file
data(starwars)

# Display the data
starwars
```

To do so, once again, you can:

-   Click on the green arrow at the top of the code chunk in the R Markdown (Rmd) file, or
-   Put your cursor on this line, and hit the **Run** button on the upper right corner of the pane, or
-   Type the code in the console.

This command instructs R to load some data.
You should see that the workspace area in the upper righthand corner of the RStudio window now lists a data set called `starwars` that has 87 observations of 14 variables.
As you interact with R, you will create a series of objects.
Sometimes you load them as we have done here, and sometimes you create them yourself as the byproduct of a computation or some analysis you have performed.

However printing the whole dataset in the console is not that useful.
One advantage of RStudio is that it comes with a built-in data viewer.
Click on the name `starwars` in the *Environment* pane (upper right window) that lists the objects in your workspace.
This will bring up an alternative display of the data set in the *Data Viewer* (upper left window).
You can close the data viewer by clicking on the *x* in the upper lefthand corner.

What you should see are fourteen columns of data, each row representing a different character from Star Wars: the first entry in each row is the name of the character, the second is height in centimeters, and the third is the mass in kilograms.
Use the scrollbar on the right side of the console window to examine the complete data set.

Note that the row numbers in the first column are not part of the `starwars` data.
R adds them as part of its printout to help you make visual comparisons.
You can think of them as the index that you see on the left side of a spreadsheet.
In fact, the comparison to a spreadsheet will generally be helpful.
R has stored the `starwars` data in a kind of spreadsheet or table called a *data frame*.

You can see the dimensions -- the number of observations and variables -- of this data frame by typing:

```{r dim-data, echo = TRUE}
dim(starwars)
```

This command should output `[1] 87 14`, indicating that there are 87 rows or observations and 14 columns or variables.
You can see the names of these columns (or variables) by typing:

```{r names-data, echo=TRUE}
names(starwars)
```

**Exercise:** What are some of the values for `homeworld` included in this dataset?

Hint: Take a look at the `homeworld` variable in the Data Viewer to answer this question.

Let's start to examine the data a little more closely.
To find out more about this data set, you could use some help.
Remove the `#` from the line of code below and then run the code chunk.

```{r help-starwars, exercise=TRUE}
#?starwars
```

You should see the documentation on the data set in the Help window.
Any time you need more information about a dataset, function, or package of interest, typing `?<NAME_HERE>` in the console will bring up its help page!
Try out the other tabs there briefly.

## Data Exploration

At this point, you might notice that many of the commands in R look a lot like functions from math class; that is, invoking R commands means supplying a function with some number of arguments.
The `dim` and `names` commands, for example, each took a single argument, the name of a data frame.

The `dplyr` package aims to provide a function for each basic verb of data manipulation.
These verbs can be organised into three categories based on the component of the dataset that they work with:

-   Rows:

    -   `filter()` chooses rows based on column values.
    -   `slice()` chooses rows based on location.
    -   `arrange()` changes the order of the rows.

-   Columns:

    -   `select()` changes whether or not a column is included.
    -   `rename()` changes the name of columns.
    -   `mutate()` changes the values of columns and creates new columns.
    -   `relocate()` changes the order of the columns.

-   Groups of rows:

    -   `summarise()` collapses a group into a single row.

The dplyr package also uses the `%>%` operator, called a **pipe**.
Basically, it takes the output of the current line and tells R to continue into the following line of code.

Putting the functions with the pipe operator, we can do something like this:

```{r view-species, exercise=TRUE}
starwars %>%
  select(species) %>%
  slice(1:100)
```

Reading the code in plain English: From the `starwars` data frame, we select the column `species`.
We want the first 100 rows of the column `species`.

**Exercise:** Try selecting a different column to observe and only view the first 50 rows.

```{r new-column, exercise=TRUE}
# Write your code here
```

### Mutate

We can create new columns in our data frame through the `mutate()` function.

```{r new-columns, exercise = TRUE}
starwars <- starwars %>%
  mutate(is_Human = (species == "Human"))

starwars %>%
  select(species, is_Human)
```

See how we used the `select()` function to compare these two columns side-by-side!

The `mutate()` function added a new variable to the `starwars` data frame containing the values of either `TRUE` if the species was Human, or `FALSE` if it was not.

Here, we've asked R to create *logical* data, data where the values are either `TRUE` or `FALSE`.
Other data types we've used are *numeric* and *character*.

### Filtering

We can reduce the data set to a subset of rows by filtering.
Here, we are going to filter on a particular value of `skin_color` and `eye_color`.

```{r try-filtering-diamonds, exercise = TRUE}
starwars %>%
  filter(skin_color == "fair" & eye_color =="blue")
```

**Exercise**: Try filtering another variable.

```{r new-filter, exercise=TRUE}
# Write your code here
```

### Booleans

In addition to simple mathematical operators like subtraction and division, you can ask R to make logical comparisons like greater than, `>`, less than, `<`, and equality, `==`.
For example, above we asked R to compare the species variable and the value "Human" using the equality boolean operator, `==`.

We can ask if the mass of the character is greater than 50 kg:

```{r x-greater-than-y, exercise = TRUE}
starwars %>%
  filter(mass > 50)
```

You may have noticed that the syntax and function of all these verbs are very similar:

-   The first argument is a data frame.
-   The subsequent arguments describe what to do with the data frame.
-   The result is a new data frame

Together these properties make it easy to do complex things with a few lines of R code!

## Data Visualization

R has some powerful functions for making graphics.
We will utilize the `ggplot2` package for these visualizations.

To build a ggplot, we will use the following basic template that can be used for different types of plots:

```{r basic-template, eval=FALSE}
ggplot(data = <DATA>, mapping = aes(<MAPPINGS>)) +  
  <GEOM_FUNCTION>() + 
  labs(title = "YOUR TITLE", x = "X-label", y = "Y-label")
```

In English, the above code uses the following:

-   `ggplot()` is the function we are using
-   `data` is the data set we are plotting from
-   `mapping` specifies the variables of interest
-   `<GEOM_FUNCTION>()` will be the specific type of plot to make, i.e. `geom_point`, `geom_bar`, etc.
-   `labs()` specifies a title and labels for the axes

Let's visualize the distribution of the character heights v. masses:

```{r plot-height-vs-mass, echo=TRUE, warning=FALSE}
ggplot(data = starwars, aes(x = height, y = mass)) +
  geom_point() +
  labs(title = "Height v. Mass",
       x = "Height (cm)", y = "Mass (kg)")
```

If you run the plotting code, you should see the plot appear under the *Plots* tab of the lower right panel of RStudio.
Notice that the command above again looks like a function, this time with arguments separated by commas.

If we want to graph a **categorical variable** such as `gender`, we can use boxplots.

```{r better-plots-2, echo=TRUE, warning=FALSE}
ggplot(data = starwars, aes(x = gender, y = height, fill = gender)) +
  geom_boxplot() +
  labs(title = 'Gender v. Height',
       x = "Gender",
       y = "Height (cm)",
       fill = "Gender")
```

Here, we used the `fill` option to color the plot by the different categories of our variable.
`ggplot` has tons of other cool features!
To learn more about the `ggplot` function, check out the `ggplot` help page by running the code chunk below:

```{r plot-help, echo=TRUE}
?ggplot
```

![](images/help.jpeg){width="90%"}

Notice that the help file replaces the plot in the lower right panel.
You can toggle between plots and help files using the tabs at the top of that panel.

**Exercise:** Now play with the `ggplot` function to create a plot of interest to you.

```{r plot-of-something-interesting, eval=FALSE}
ggplot(data = "____", aes(x = "____", y = "____")) +
  "____"
```

For help with plotting with the `ggplot2` package, check out [this cheatsheet!](https://rstudio.com/wp-content/uploads/2015/03/ggplot2-cheatsheet.pdf)
The best (and easiest) way to learn the syntax is to take a look at the sample plots provided on that page, and modify the code to fit your needs.

## Submitting Your Work

Now that you've gotten some practice coding - let's go over how to submit your work for classes.
Your professors will most likely ask for your final **PDF** file.
We will briefly go over how to create these outputs from an .Rmd file.

Turning your assignment can be accomplished from the following steps.

1.  Once you are finished with the assignment, **Knit** the file.
2.  Select all updated files in the **Git** tab of the **Environment** pane.
3.  **Commit** the files with an informative title, and **push** the files to Github.
4.  Go to your class's Gradescope page. **Submit the PDF** of your assignment.
5.  **Select** the page each exercise is associated with.
6.  Done!

![](images/gradescope.png){width="50%"}

## Troubleshooting

Sometimes, your code will work in your .Rmd but will not compile.
This is because when you **knit**, your machine is running the code line by line.
If one of your lines of code was entered in the console instead of in the file, uses a variable not created until later in your document, repeats a code chunk name, or possesses any other fault, you will run into an error.

R provides thorough error messages letting you know the issue at hand.
Very often, it is because the data or a package is not loaded into the file.
There are a lot of great resources online for troubleshooting error messages.
Sites like **Stack Overflow** <https://stackoverflow.com/questions/tagged/rstudio> provide lots of resources and answers to questions people have already asked.
Likewise, your TA and professors are here to help!
If you cannot find a solution online, post your code (privately) and error message on your **Ed Discussion board**, or visit your professor/TA's office hours.

## Resources for Learning R

That was a short introduction to R and RStudio, but your instructors will provide you with more functions and a more complete sense of the language as your course progresses.
You might find the following tips and resources helpful.

-   Many courses use the Tidyverse while other courses will expect you to learn to work in base R, rather than in the RStudio IDE. In Tidyverse-flavored courses, you will use `dplyr` (for data wrangling) and `ggplot2` (for data visualization) extensively.
    If you are googling for R code, make sure to also include these package names in your search query.
    For example, instead of googling "scatterplot in R", google "scatterplot in R with ggplot2".

-   Duke offers Coursera courses for free to Duke students through this link: <https://online.duke.edu/coursera-for-duke/>

-   There is a terrific resource on Medium called Towards Data Science, and you can find good information there, although you may have a limited number of free articles to read.
    <https://towardsdatascience.com/data-science/home>

-   Do a quick search on "Free books on R" and you will find a huge array of choices.

-   Lots of R users post their own guides that you can find by searching.
    Here's one from David Romney at Harvard: <https://scholar.harvard.edu/dromney/online-resources-learning-r>

-   The r-statistics blog is very helpful: <https://www.r-statistics.com/> In fact, you will find that the R community by its very nature is beginner friendly.

-   The following cheatsheets may come in handy throughout your courses.
    Note that some of the code on these cheatsheets may be too advanced for your needs now, however the majority of it will become useful as you progress through your statistical science courses.

    -   [Data wrangling cheatsheet](http://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf)
    -   [Data visualization cheatsheet](https://github.com/rstudio/cheatsheets/raw/master/data-visualization-2.1.pdf)
    -   [R Markdown](https://github.com/rstudio/cheatsheets/raw/master/rmarkdown-2.0.pdf)

## Acknowledgements

This is derived from the `Learning R Tutorials` website.
Thanks to Joan Durso, Maria Tackett, and George Lindner for all their help!
